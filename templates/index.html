<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Discord-like Anonymous Chat</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
  <script defer src="{{ url_for('static', filename='chat.js') }}"></script>
  </head>
<body>
  <div class="main-layout">
    <div class="sidebar" id="server-sidebar">
      <!-- Servers will be rendered here -->
      <button id="add-server" class="server add-server">+</button>
                </div>
    <div class="channels" id="channel-list">
      <!-- Channels will be rendered here -->
    </div>
    <div class="chat-section" style="position:relative;">
      <div class="pinned-bar" id="pinned-bar"></div>
      <div class="topbar">
        <div id="chat-header">Select a channel</div>
        <button id="clear-chat-btn" class="btn btn-danger">Clear Chat</button>
      </div>
      <div class="chat-messages" id="messages"></div>
      <div class="typing" id="typing-indicator" style="display:none;"></div>
      <div id="attachment-preview" style="display:none; padding: 0 1rem 0.5rem 1rem;"></div>
      <form class="chat-form" id="chat-form" style="display:none;">
        <input class="chat-input" id="message-input" autocomplete="off" placeholder="Type a message..." />
        <button id="upload-btn" class="btn" type="button" title="Attach file">ðŸ“Ž</button>
        <input id="file-input" type="file" style="display:none" accept="image/*,.pdf,.txt,.md,.csv,.json,.zip,.tar,.gz,.7z,.doc,.docx,.ppt,.pptx,.xls,.xlsx" />
        <button id="emoji-btn" class="btn" type="button" title="Pick emoji">ðŸ˜Š</button>
        <button class="btn" type="submit">Send</button>
      </form>
      <div id="emoji-picker" style="display:none; position:absolute; bottom:70px; right:16px; width:595px; height:433px; box-sizing:border-box; background:#000; border:1px solid #23272a; border-radius:10px; padding:12px; overflow:hidden; z-index:999;"></div>
    </div>
    <div class="user-list">
      <div class="user-list-toolbar">
        <div id="current-user" class="current-user"></div>
        <div class="user-actions">
          <button id="profile-btn" class="btn">Edit Profile</button>
          <button id="logout-btn" class="btn btn-danger">Logout</button>
        </div>
      </div>
      <div id="user-list" class="user-list-body">
        <!-- User list will be rendered here -->
      </div>
    </div>
    <div id="add-server-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;z-index:1000;align-items:center;justify-content:center;">
      <div style="background:#23272a;padding:2rem 2.5rem;border-radius:12px;min-width:300px;max-width:90vw;box-shadow:0 4px 32px #000b;display:flex;flex-direction:column;gap:1rem;align-items:center;">
        <h3 style="color:#fff;margin:0 0 1rem 0;">Add Server</h3>
        <label style="width:100%;color:#fff;">Server Name:<br>
          <input id="add-server-name" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="32" autofocus>
        </label>
        <label style="width:100%;color:#fff;">Password (required):<br>
          <input id="add-server-password" type="password" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="64" placeholder="Set a password to manage this server">
        </label>
        <label style="width:100%;color:#fff;">Description (optional):<br>
          <input id="add-server-desc" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="120" placeholder="Short description">
        </label>
        <div style="display:flex;gap:1rem;justify-content:center;width:100%;margin-top:1rem;">
          <button id="add-server-save" class="btn">Add</button>
          <button id="add-server-cancel" class="btn" style="background:#444;">Cancel</button>
        </div>
      </div>
    </div>
    <div id="add-channel-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;z-index:1000;align-items:center;justify-content:center;">
      <div style="background:#23272a;padding:2rem 2.5rem;border-radius:12px;min-width:300px;max-width:90vw;box-shadow:0 4px 32px #000b;display:flex;flex-direction:column;gap:1rem;align-items:center;">
        <h3 style="color:#fff;margin:0 0 1rem 0;">Add Channel</h3>
        <label style="width:100%;color:#fff;">Channel Name:<br>
          <input id="add-channel-name" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="32" autofocus>
        </label>
        <div style="display:flex;gap:1rem;justify-content:center;width:100%;margin-top:1rem;">
          <button id="add-channel-save" class="btn">Add</button>
          <button id="add-channel-cancel" class="btn" style="background:#444;">Cancel</button>
        </div>
      </div>
    </div>
    <div id="profile-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;z-index:100;align-items:center;justify-content:center;">
      <div style="background:#23272a;padding:2rem 2.5rem;border-radius:12px;min-width:300px;max-width:90vw;box-shadow:0 4px 32px #000b;display:flex;flex-direction:column;gap:1rem;align-items:center;">
        <h3 style="color:#fff;margin:0 0 1rem 0;">Edit Profile</h3>
        <label style="width:100%;color:#fff;">Nickname:<br>
          <input id="profile-nickname" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="32">
        </label>
        <label style="width:100%;color:#fff;">Avatar (emoji):<br>
          <input id="profile-avatar" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="2">
        </label>
        <label style="width:100%;color:#fff;">Status:<br>
          <input id="profile-status" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="64">
        </label>
        <div style="display:flex;gap:1rem;justify-content:center;width:100%;margin-top:1rem;">
          <button id="profile-save" class="btn">Save</button>
          <button id="profile-cancel" class="btn" style="background:#444;">Cancel</button>
        </div>
      </div>
    </div>
    <div id="toast" class="toast"></div>
  </div>
</body>
</html>
