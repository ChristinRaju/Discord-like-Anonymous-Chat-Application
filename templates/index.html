<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Discord-like Anonymous Chat</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
  <script defer src="{{ url_for('static', filename='chat.js') }}"></script>
  <style>
    html, body { height: 100%; }
    body { min-height: 100vh; }
    .main-layout { display: flex; height: 100vh; }
    .sidebar { width: 70px; background: #23272a; display: flex; flex-direction: column; align-items: center; padding: 1rem 0; gap: 1rem; }
    .sidebar .server { width: 48px; height: 48px; background: #36393f; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: #fff; cursor: pointer; margin-bottom: 0.5rem; border: 2px solid transparent; transition: border 0.2s; }
    .sidebar .server.selected { border: 2px solid #5865f2; }
    .sidebar .add-server { background: #5865f2; color: #fff; font-size: 2rem; }
    .channels { width: 180px; background: #2f3136; padding: 1rem 0.5rem; display: flex; flex-direction: column; gap: 0.5rem; }
    .channels .channel { padding: 0.5rem 1rem; border-radius: 6px; color: #b9bbbe; cursor: pointer; }
    .channels .channel.selected, .channels .channel:hover { background: #36393f; color: #fff; }
    .chat-section { flex: 1; display: flex; flex-direction: column; background: #313338; }
    .pinned-bar { padding: 0.5rem 1rem; background: #23272a; border-bottom: 1px solid #23272a; color: #fff; font-size: 0.9rem; }
    .chat-header { padding: 1rem; border-bottom: 1px solid #23272a; color: #fff; font-size: 1.1rem; }
    .chat-messages { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.5rem; }
    .chat-form { display: flex; gap: 0.5rem; padding: 1rem; border-top: 1px solid #23272a; background: #2b2d31; }
    .chat-input { flex: 1; padding: 0.75rem; border-radius: 8px; border: none; background: #40444b; color: #fff; font-size: 1rem; }
    .btn { background: #5865f2; color: #fff; border: none; border-radius: 8px; padding: 0.75rem 1.25rem; font-size: 1rem; cursor: pointer; transition: background 0.2s; }
    .btn:hover { background: #4752c4; }
    .user-list { width: 180px; background: #2f3136; padding: 1rem 0.5rem; border-left: 1px solid #23272a; display: flex; flex-direction: column; gap: 0.5rem; }
    .user-list .user { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.5rem; border-radius: 6px; color: #fff; background: #36393f; }
    .user-list .user .avatar { font-size: 1.5rem; }
    .typing { font-size: 0.95em; color: #b9bbbe; min-height: 1.2em; margin: 0.5rem 0 0 0.5rem; }
    @media (max-width: 900px) {
      .user-list { display: none; }
      .channels { width: 120px; }
    }
    @media (max-width: 600px) {
      .sidebar { width: 48px; }
      .channels { width: 70px; font-size: 0.9em; }
      .chat-header, .chat-form { padding: 0.5rem; }
    }
  </style>
</head>
<body>
  <div class="main-layout">
    <div class="sidebar" id="server-sidebar">
      <!-- Servers will be rendered here -->
      <button id="add-server" class="server add-server">+</button>
      <div id="add-server-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;z-index:100;align-items:center;justify-content:center;">
        <div style="background:#23272a;padding:2rem 2.5rem;border-radius:12px;min-width:300px;max-width:90vw;box-shadow:0 4px 32px #000b;display:flex;flex-direction:column;gap:1rem;align-items:center;">
          <h3 style="color:#fff;margin:0 0 1rem 0;">Add Server</h3>
          <label style="width:100%;color:#fff;">Server Name:<br>
            <input id="add-server-name" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="32" autofocus>
          </label>
          <div style="display:flex;gap:1rem;justify-content:center;width:100%;margin-top:1rem;">
            <button id="add-server-save" class="btn">Add</button>
            <button id="add-server-cancel" class="btn" style="background:#444;">Cancel</button>
          </div>
        </div>
      </div>
      <div id="add-channel-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;z-index:100;align-items:center;justify-content:center;">
        <div style="background:#23272a;padding:2rem 2.5rem;border-radius:12px;min-width:300px;max-width:90vw;box-shadow:0 4px 32px #000b;display:flex;flex-direction:column;gap:1rem;align-items:center;">
          <h3 style="color:#fff;margin:0 0 1rem 0;">Add Channel</h3>
          <label style="width:100%;color:#fff;">Channel Name:<br>
            <input id="add-channel-name" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="32" autofocus>
          </label>
          <div style="display:flex;gap:1rem;justify-content:center;width:100%;margin-top:1rem;">
            <button id="add-channel-save" class="btn">Add</button>
            <button id="add-channel-cancel" class="btn" style="background:#444;">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    <div class="channels" id="channel-list">
      <!-- Channels will be rendered here -->
    </div>
    <div class="chat-section" style="position:relative;">
      <div class="pinned-bar" id="pinned-bar"></div>
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 1px solid #23272a; color: #fff; font-size: 1.1rem;">
        <div id="chat-header">Select a channel</div>
        <button id="clear-chat-btn" class="btn" style="background: #f04747; padding: 0.5rem 1rem; font-size: 0.9rem;">Clear Chat</button>
      </div>
      <div class="chat-messages" id="messages"></div>
      <div class="typing" id="typing-indicator" style="display:none;"></div>
      <div id="attachment-preview" style="display:none; padding: 0 1rem 0.5rem 1rem;"></div>
      <form class="chat-form" id="chat-form" style="display:none;">
        <input class="chat-input" id="message-input" autocomplete="off" placeholder="Type a message..." />
        <button id="upload-btn" class="btn" type="button" title="Attach file">ðŸ“Ž</button>
        <input id="file-input" type="file" style="display:none" accept="image/*,.pdf,.txt,.md,.csv,.json,.zip,.tar,.gz,.7z,.doc,.docx,.ppt,.pptx,.xls,.xlsx" />
        <button id="emoji-btn" class="btn" type="button" title="Pick emoji">ðŸ˜Š</button>
        <button class="btn" type="submit">Send</button>
      </form>
      <div id="emoji-picker" style="display:none; position:absolute; bottom:70px; right:16px; width:595px; height:433px; box-sizing:border-box; background:#000; border:1px solid #23272a; border-radius:10px; padding:12px; overflow:hidden; z-index:999;"></div>
    </div>
    <div class="user-list" id="user-list">
      <!-- User list will be rendered here -->
    </div>
    <button id="profile-btn" style="position:fixed;top:1rem;right:1rem;z-index:10;background:#5865f2;color:#fff;border:none;border-radius:50%;width:48px;height:48px;font-size:1.5rem;cursor:pointer;">ðŸ‘¤</button>
    <div id="profile-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;z-index:100;align-items:center;justify-content:center;">
      <div style="background:#23272a;padding:2rem 2.5rem;border-radius:12px;min-width:300px;max-width:90vw;box-shadow:0 4px 32px #000b;display:flex;flex-direction:column;gap:1rem;align-items:center;">
        <h3 style="color:#fff;margin:0 0 1rem 0;">Edit Profile</h3>
        <label style="width:100%;color:#fff;">Nickname:<br>
          <input id="profile-nickname" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="32">
        </label>
        <label style="width:100%;color:#fff;">Avatar (emoji):<br>
          <input id="profile-avatar" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="2">
        </label>
        <label style="width:100%;color:#fff;">Status:<br>
          <input id="profile-status" type="text" style="width:100%;padding:0.5rem;border-radius:6px;border:none;background:#40444b;color:#fff;" maxlength="64">
        </label>
        <div style="display:flex;gap:1rem;justify-content:center;width:100%;margin-top:1rem;">
          <button id="profile-save" class="btn">Save</button>
          <button id="profile-cancel" class="btn" style="background:#444;">Cancel</button>
        </div>
      </div>
    </div>
    <div id="toast" class="toast"></div>
  </div>
</body>
</html>
